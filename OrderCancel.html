<!DOCTYPE html>
<html lang="th">

<head>
    <script src="./library/utils.js"></script>
    <link rel="stylesheet" href="https://phurich.github.io/phuthon/library/style.css">
    <html-header></html-header>
</head>

<body>
    <img src="./library/logo600px.png" style="max-width:100%;margin: auto;display: block;" alt="‡∏†‡∏π‡∏ò‡∏£‡πÄ‡∏î‡∏•‡∏¥‡πÄ‡∏ß‡∏≠‡∏£‡∏µ‡πà">
    <form id="orderCancel" style="margin: 20px;" method="post">
        <div class="row">
            <div class="justify-content-center">
                ‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ üòä ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô
                üìû‡∏Ç‡∏≠‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏£‡∏≤‡∏ö<br><br>
            </div>
            <div>
                <input name="cancel" id="cancel0" type="radio" value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô" onclick="showContent();">
                <label for="cancel0">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å "‡∏ö‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" (‡∏Å‡∏î‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å)</label>
                <div id="content" style="margin-left: 50px; display: none;">
                </div>
            </div>
            <div>
                <input name="cancel" id="cancel1" type="radio" value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" onclick="hideContent();">
                <label for="cancel1">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</label>
            </div>
            <div>
                <!-- Hidden textarea to store the content data -->
                <textarea name="canceledList" id="canceledList" style="display: none;"></textarea>
            </div>
            <div><input name="restaurant" id="restaurant" type="hidden" value=""></div>
            <div><input name="orderNumber" id="orderNumber" type="hidden" value=""></div>
        </div>
        <div class="row justify-content-center">
            <label for="reason">‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
            <input name="reason" id="reason" type="text" style="width:35%">
        </div>
        <div class="row justify-content-center">
            <label for="quickReason">‡∏Ñ‡∏≥‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡∏î‡πà‡∏ß‡∏ô</label>
            <span name="quickReason" class="button button-warning button-space" onclick="assignText(event)">? ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà 1</span>
            <span name="quickReason" class="button button-warning button-space" onclick="assignText(event)">? ‡∏´‡∏°‡∏î</span>
            <span name="quickReason" class="button button-warning button-space" onclick="assignText(event)">‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î</span>
            <span name="quickReason" class="button button-warning button-space" onclick="assignText(event)">‡∏£‡πâ‡∏≤‡∏ô‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î ?:00 ‡∏ô.</span>
        </div>
        <div class="row justify-content-center">
            <button name="submit" type="submit" class="button button-lg button-danger">üö´‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πåüò•</button>
        </div>
    </form>
</body>
<script>
    function assignText(event) {
        document.getElementById('reason').value += event.target.innerText;
    }

    function showContent() {
        document.getElementById('content').style.display = 'block';
        document.getElementById('canceledList').value = document.getElementById('content').innerText;
    }

    function hideContent() {
        document.getElementById('content').style.display = 'none';
        document.getElementById('canceledList').value = '';
    }

    function ensureSpacesAroundNumbers(input) {
        // Regular expression to match numbers that are not already surrounded by spaces
        let regex = /(\s+)?\d+(\.\d+)?(\s+)?/gm;
        // Function to add spaces around a match
        let addSpaces = match => ' ' + match.trim() + ' ';
        // Replace numbers not surrounded by spaces with the same number surrounded by spaces
        let output = input.replace(regex, addSpaces);
        return output;
    }

    function processContent() {
        let content = document.getElementById('content');
        let manipulatedContent = ensureSpacesAroundNumbers(content.textContent);
        content.innerHTML = manipulatedContent.split(/\|+/gm).map(word => {
            return `<span>${word}</span><br>`;
        }).join(' ');
        Array.from(content.children).forEach(child => {
            child.addEventListener('click', function () {
                this.classList.toggle('strikethrough');
                if (this.classList.contains('strikethrough')) {
                    // If the class 'strikethrough' is present, add brackets
                    this.textContent = '[' + this.textContent + ']';
                } else {
                    // If the class 'strikethrough' is not present, remove brackets
                    this.textContent = this.textContent.replace(/^\[/, '').replace(/\]$/, '');
                }
                document.getElementById('canceledList').value = document.getElementById('content').textContent;
            });
        });
    }

    document.getElementById('orderCancel').addEventListener('submit', function (e) {
        let radioButtons = document.getElementsByName('cancel');
        let firstRadioButton = radioButtons[0];
        let preventSubmit = false; // Track if submission should be prevented

        if (!Array.from(radioButtons).some(radio => radio.checked)) {
            preventSubmit = true;
            swal("‚ùå‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å");
        }

        if (firstRadioButton.checked) {
            let content = document.getElementById('content');
            let isStrikethrough = Array.from(content.children).some(child => child.classList.contains('strikethrough'));

            if (!isStrikethrough) {
                preventSubmit = true;
                swal("‚ùå‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å");
            }
        }

        if (preventSubmit) {
            e.preventDefault();
        }
    });


    document.onreadystatechange = () => {
        if (document.readyState === "complete") {

            // Get the full URL from the browser's address bar
            const url = window.location.href;
            // Extract the query string
            const queryString = url.split('?')[1];
            // Decode the query string
            const decodedString = decodeURIComponent(queryString);
            // Extract key-value pairs
            const params = new URLSearchParams(decodedString);
            // Retrieve parameters
            //const page = params.get('page');
            //const rider = params.get('rider');
            const list = params.get('list').replace(/[\r\n]+/gm, "|");
            const regex = /^(.*)\|.+(\d{5})\|/gm;
            const matched = regex.exec(list);

            if (matched) {
                document.getElementById("restaurant").value = matched[1];
                document.getElementById("orderNumber").value = matched[2];
                document.getElementById("content").innerHTML = list.replace(matched[0], "");
            } else {
                document.getElementById("content").innerHTML = "üò• ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£";
            }

            document.getElementById('orderCancel').action = currentActionUrl;
            processContent();
        }
    };

</script>

</html>