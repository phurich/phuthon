<!DOCTYPE html>
<html lang="th">

<head>
    <script src="./library/utils.js"></script>
    <!-- CSS files -->
    <link rel="stylesheet" href="https://phurich.github.io/phuthon/library/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/1.1.2/css/bootstrap-multiselect.css">

    <!-- JavaScript files -->
    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.quicksearch/2.3.1/jquery.quicksearch.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/js/bootstrap-multiselect.min.js"></script>
    <style>
        .label-textarea {
            display: flex;
            flex-wrap: wrap;
            /* Allows wrapping of elements */
            align-items: center;
        }

        .first-column {
            display: flex;
            /* Align label and input in one row */
            flex-direction: column;
            /* Stack label and input vertically */
            gap: 0.5em;
            /* Space between label and input */
        }

        .second-column textarea {
            height: 5em;
            /* Adjust height of textarea */
        }


        .label-textarea label,
        .label-textarea input {
            flex: 0 0 auto;
            /* Keep label and input in the same column */
        }

        .label-textarea textarea {
            flex: 1 1 100%;
            /* Make the textarea take up the second column or full width */
        }

        /* Responsive design for small screens */
        @media (max-width: 600px) {
            .label-textarea {
                flex-direction: column;
                /* Stack elements vertically */
                align-items: flex-start;
                /* Align elements to the left */
            }
        }

        .checkbox {
            margin-top: 0px;
            margin-bottom: 0px;
        }
    </style>
    <html-header></html-header>
</head>

<body>
    <img src="./library/logo600px.png" alt="‡∏†‡∏π‡∏ò‡∏£‡πÄ‡∏î‡∏•‡∏¥‡πÄ‡∏ß‡∏≠‡∏£‡∏µ‡πà">
    <div id="dialog-overlay" class="dialog-overlay"></div>
    <div id="dialog-sky" class="setting-sky sky">
        <div class="satellite"></div>
    </div>
    <form id="assignRider" name="assignRider" style="margin: 20px;" method="post" accept-charset="UTF-8">
        <div class="form-group row">
            <label>üõµ‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πåüí®</label>
            <div class="form-check-inline">
                <div>
                    <input name="rider" id="rider_0" type="radio" value="Mo|Ufe2ad2a0e3a3c6d42c5de0716034dacd">
                    <label id="lblRider_0" for="rider_0">‡πÇ‡∏°</label>
                </div>
                <div>
                    <input name="rider" id="rider_1" type="radio" value="Fluke|Ub357c51443beaf4a9164b8131437aba1">
                    <label for="rider_1">‡∏ü‡∏•‡∏∏‡πä‡∏Ñ</label>
                </div>
                <div>
                    <input name="rider" id="rider_2" type="radio" value="Piya|U966035e63ab3e7d6707ec3d226e0995d">
                    <label for="rider_2">‡∏õ‡∏¥‡∏¢‡∏∞</label>
                </div>
                <div>
                    <input name="rider" id="rider_3" type="radio" value="Champ|U6fd0d6c2e9a26995749ce8d93c888ab1">
                    <label for="rider_3">‡πÅ‡∏ä‡∏°‡∏õ‡πå</label>
                </div>
                <div>
                    <input name="rider" id="rider_4" type="radio" value="Phurich|U50cf3d26ba28cb6a75ca8a40fba2b2e0">
                    <label for="rider_4">‡∏†‡∏π</label>
                </div>
            </div>
        </div>
        <div class="form-group row">
            <label>‚è± ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå</label>
            <select title="setTimeDelay" name="timeDelay" id="timeDelay">
                <option value="10s">‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</option>
                <option value="10m">10 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="20m">20 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="30m">30 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="40m">40 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="50m">50 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="60m">60 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
            </select>
        </div>
        <div class="form-group row">
            <label for="restaurantList">üîä ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</label>
            <div class="form-check-inline">
                <select id="restaurantList" name="restaurantList" multiple="multiple">
                    <option value="KuaiChapRo">‡∏Å‡πã‡∏ß‡∏¢‡∏à‡∏±‡πä‡∏ö‡∏£‡∏™‡πÄ‡∏î‡πá‡∏î</option>
                    <option value="KuaiChapUb">‡∏Å‡πã‡∏ß‡∏¢‡∏à‡∏±‡πä‡∏ö‡∏≠‡∏∏‡∏ö‡∏•</option>
                    <option value="KTKaiMaRaB">‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡πÑ‡∏Å‡πà‡∏°‡∏∞‡∏£‡∏∞@‡∏ö‡∏≤‡∏á‡∏à‡∏≤‡∏Å</option>
                    <option value="KTChaoKao">‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏à‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤</option>
                    <option value="KTTomYam">‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡∏ï‡πâ‡∏°‡∏¢‡∏≥</option>
                    <option value="KTMiaLuang">‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏°‡∏µ‡∏¢‡∏´‡∏•‡∏ß‡∏á</option>
                    <option value="KanBan">‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô</option>
                    <option value="KhaoTomKho">‡∏Ç‡πâ‡∏≤‡∏ß‡∏ï‡πâ‡∏°‡πÇ‡∏Ñ‡∏Ñ‡∏∂‡∏Å</option>
                    <option value="KMKKhunPhu">‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏Ñ‡∏∏‡∏ì‡∏û‡∏∏‡∏Å</option>
                    <option value="KCSuKi">‡πÄ‡∏Ñ‡∏ã‡∏µ‡∏™‡∏∏‡∏Å‡∏µ‡πâ</option>
                    <option value="ChaOiLapPe">‡∏à‡πà‡∏≤‡∏≠‡πã‡∏≠‡∏¢‡∏•‡∏≤‡∏ö‡πÄ‡∏õ‡πá‡∏î</option>
                    <option value="CheTaenNue">‡πÄ‡∏à‡πä‡πÅ‡∏ï‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏î</option>
                    <option value="ChehMuaiTa">‡πÄ‡∏à‡πä‡∏´‡∏°‡∏ß‡∏¢‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á</option>
                    <option value="NaNaKhopFi">‡∏ô‡∏≤‡∏ô‡∏≤</option>
                    <option value="PhengPhiPo">‡πÄ‡∏û‡πá‡∏á‡∏û‡∏µ‡πà‡∏õ‡πâ‡∏≠‡∏°</option>
                    <option value="MaeLiKhrok">‡πÅ‡∏°‡πà‡∏•‡∏µ‡∏Ñ‡∏£‡∏Å‡∏™‡∏∞‡∏î‡∏∏‡πâ‡∏á</option>
                    <option value="RotKhenBaM">‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà@‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå</option>
                    <option value="RaChaBaMiK">‡∏£‡∏≤‡∏ä‡∏≤‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà‡∏Å‡∏ß‡∏≤‡∏á‡∏ï‡∏∏‡πâ‡∏á</option>
                    <option value="LaMun">‡∏•‡∏∞‡∏°‡∏∏‡∏ô</option>
                    <option value="LapMaeChai">‡∏•‡∏≤‡∏ö‡πÅ‡∏°‡πà‡πÉ‡∏à</option>
                    <option value="SaWetKaMon">‡πÄ‡∏®‡∏ß‡∏ï‡∏Å‡∏°‡∏•</option>
                    <option value="STChoiBanD">‡∏™‡πâ‡∏°‡∏ï‡∏≥‡∏à‡∏≠‡∏¢</option>
                    <option value="STThaiWitT">‡∏™‡πâ‡∏°‡∏ï‡∏≥‡πÑ‡∏ó‡∏¢‡∏ß‡∏¥‡∏ó‡∏¢‡∏∏</option>
                    <option value="STPaBird">‡∏™‡πâ‡∏°‡∏ï‡∏≥‡∏õ‡πã‡∏≤‡πÄ‡∏ö‡∏£‡∏¥‡πå‡∏î</option>
                    <option value="STYaiCha">‡∏™‡πâ‡∏°‡∏ï‡∏≥‡∏¢‡∏≤‡∏¢‡∏à‡πã‡∏≤</option>
                    <option value="SuMaLiNuea">‡∏™‡∏∏‡∏°‡∏≤‡∏•‡∏µ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á</option>
                    <option value="SaiWaKaiMa">‡πÑ‡∏™‡∏ß‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡πÑ‡∏Å‡πà‡∏°‡∏∞‡∏£‡∏∞</option>
                    <option value="MaLaTitRom">‡∏´‡∏°‡πà‡∏≤‡∏•‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏£‡∏°‡∏¢‡πå</option>
                    <option value="AmzBanNgon">‡∏≠‡πÄ‡∏°‡∏ã‡∏≠‡∏ô ‡∏õ‡∏ï‡∏ó.‡∏ö‡πâ‡∏≤‡∏ô‡∏á‡πà‡∏≠‡∏ô</option>
                    <option value="AmzSchool">‡∏≠‡πÄ‡∏°‡∏ã‡∏≠‡∏ô ‡∏õ‡∏ï‡∏ó.‡∏™‡∏î.</option>
                    <option value="AmzSaNam">‡∏≠‡πÄ‡∏°‡∏ã‡∏≠‡∏ô ‡∏õ‡∏ï‡∏ó.‡∏™‡∏ô‡∏≤‡∏°‡∏ä‡∏±‡∏¢</option>
                    <option value="EmPhai">‡πÄ‡∏≠‡πá‡∏°‡πÑ‡∏û‡∏£‡πå‡∏£‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏¢‡∏≠‡∏î‡∏ú‡∏±‡∏Å</option>
                </select>
                <button id="add-to-textbox" title="‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö ‡∏£‡πâ‡∏≤‡∏ô" type="button" class="button button-lg button-warning button-space">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö</button>
            </div>
        </div>
        <div class="form-group row">
            <label>üîî ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÇ‡∏î‡∏¢</label>
            <div class="form-check-inline">
                <div>
                    <input name="notify" id="notify_0" type="radio" value="0">
                    <label id="lblNotify_0" for="notify_0">üíª‡∏£‡∏∞‡∏ö‡∏ö</label>
                </div>
                <div>
                    <input name="notify" id="notify_1" type="radio" value="1">
                    <label for="notify_1">üõµ‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå</label>
                </div>
            </div>
        </div>
        <div class="form-group row">
            <div id="textareas">

            </div>
        </div>
        <div class="form-group row">
            <div><label for="detailArea">üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</label></div>
            <div>
                <ul>
                    <li><span onclick="insertAtCursor('detailArea',' (üéâ‡∏™‡∏±‡πà‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß)');">(üéâ‡∏™‡∏±‡πà‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß)</span></li>
                    <li><span onclick="insertAtCursor('detailArea',' (‚òéÔ∏è‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≤‡∏á‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå / üö´‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏•‡∏ô‡πå)');">‚òéÔ∏è‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≤‡∏á‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</span></li>
                    <li><span onclick="insertAtCursor('detailArea',' (üéâ‡∏™‡∏±‡πà‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß / üíµ‡∏à‡πà‡∏≤‡∏¢‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß)');">(üíµ‡∏™‡∏±‡πà‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß/‡∏à‡πà‡∏≤‡∏¢‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß)</span></li>
                    <li><span onclick="insertAtCursor('detailArea',' üè™‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ');">üè™‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ</span></li>
                    <li><span onclick="insertAtCursor('detailArea',' üõµ‡∏™‡πà‡∏á‡πÄ‡∏•‡∏¢ ‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏à‡∏∞‡πÇ‡∏≠‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á');">üõµ‡∏™‡πà‡∏á‡πÄ‡∏•‡∏¢ ‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏à‡∏∞‡πÇ‡∏≠‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á</span></li>
                </ul>
            </div>
            <textarea style="width: 100%" id="detailArea" name="detailArea" rows="7" maxlength="900" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô"></textarea>
        </div>
        <div class="form-group row">
            <div><label for="address">üè¨ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label></div>
            <div>
                <ul>
                    <li><span onclick="insertAtCursor('address','‚òéÔ∏è ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏¢');">‚òéÔ∏è ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</span></li>
                    <li><span onclick="insertAtCursor('address','üåê ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Å‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏¢');">üåê ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span></li>
                </ul>
            </div>
            <textarea style="width: 100%" id="address" name="address" rows="4" maxlength="900" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Google Pluscode URL"></textarea>
        </div>
        <div class="row justify-content-center">
            <div class="file-input-container">
                <label for="fileInput" id="fileLabel" class="button button-info button-lg">üìé ‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå (jpg)</label>
                <input type="file" id="fileInput" name="photo" accept="image/jpeg" multiple>
            </div>
        </div>
        <div class="row justify-content-center">
            <canvas id="canvas" style="display:none;"></canvas>
            <img id="photo" alt="Captured Photo" style="display:none;">
        </div>
        <input type="hidden" id="rider" name="rider" value="">
        <input type="hidden" id="row" name="row" value="">
        <input type="hidden" id="imageURL" name="imageURL" value="">
        <div class="row justify-content-center">
            <button name="formSubmit" type="submit" class="button button-lg button-primary">üõµ ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</button>
            <button name="reset" type="reset" class="button button-lg button-danger button-space">üßπ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ó</button>
            <button name="toggle" type="button" class="button button-lg button-warning button-space" onclick="document.getElementsByName('formSubmit')[0].disabled = false;">üîÅ</button>
        </div>
    </form>
    <script>
        document.onreadystatechange = () => {
            if (document.readyState === "complete") {
                let select = document.getElementById("restaurantList");
                //$(select).multiselect('refresh');
                let options = Array.from(select.options);

                options.sort(function (a, b) {
                    return a.text.trim().localeCompare(b.text.trim());
                });
                select.innerHTML = "";

                for (let option of options) {
                    option.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;" + option.innerHTML; //add space before text option
                    select.appendChild(option);
                }

                $(select).multiselect('rebuild');
                $('[data-toggle="tooltip"]').tooltip();

                document.getElementById('assignRider').action = currentActionUrl;
                //document.getElementById('assignRider').action = testActionUrl;
            }
        };

        $('#restaurantList').multiselect({
            enableFiltering: true,
            enableCaseInsensitiveFiltering: true,
            filterPlaceholder: '‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô',
            nonSelectedText: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡πâ‡∏≤‡∏ô',
            includeSelectAllOption: false
        });

        $('#add-to-textbox').click(function () {
            let selectedOptions = $('#restaurantList option:selected');
            let index = 0;
            let orderNumber = "‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå#" + createOrderNumber();
            $('#textareas').empty(); // Clear the existing textareas
            selectedOptions.each(function () {
                let label = $(this).text().trim();
                let nameID = 'restaurantArea' + index;

                // Create elements
                let labelElement = $('<label for="' + nameID + '">' + label + '</label>');
                let textarea = $('<textarea id="' + nameID + '" name="' + nameID + '" rows="5" cols="20" maxlength="900"></textarea>');
                let fileInput = $('<input type="file" id="image' + index + '" name="image' + index + '" multiple>'); // Create file input element
                let div = $('<div class="label-textarea"></div>');

                // Append label and file input to the first column, textarea to the second
                let firstColumn = $('<div class="first-column"></div>');
                firstColumn.append(labelElement);
                firstColumn.append(fileInput);

                let secondColumn = $('<div class="second-column"></div>');
                secondColumn.append(textarea);

                div.append(firstColumn);
                div.append(secondColumn);

                // Append the div to the textareas container
                $('#textareas').append(div);

                // Pre-fill the textarea with the label and order number
                document.getElementById(nameID).value = label + '\r\n' + orderNumber + '\r\n';
                index++;
            });
        });


        $('form').on('reset', function () {
            setTimeout(function () {
                $('select').multiselect('refresh');
                $('#textareas').empty(); // Clear the dynamically added textareas
                document.getElementsByName('formSubmit')[0].disabled = false;
                document.getElementById('photo').src = "";
                document.getElementById('photo').style.display = 'none';
            }, 500);
        });

        function insertAtCursor(id, myValue) {
            myField = document.getElementById(id);
            //IE support
            if (document.selection) {
                myField.focus();
                sel = document.selection.createRange();
                sel.text = myValue;
            }
            //MOZILLA and others
            else if (myField.selectionStart || myField.selectionStart == '0') {
                var startPos = myField.selectionStart;
                var endPos = myField.selectionEnd;
                myField.value = myField.value.substring(0, startPos)
                    + myValue
                    + myField.value.substring(endPos, myField.value.length);
                myField.selectionStart = startPos + myValue.length;
                myField.selectionEnd = startPos + myValue.length;
            } else {
                myField.value += myValue;
            }
        }

        function createOrderNumber() {
            let date = new Date();
            let hours = date.getHours();
            let minutes = date.getMinutes();
            let seconds = date.getSeconds();

            // Calculate the number of seconds since midnight
            let totalSeconds = (hours * 3600) + (minutes * 60) + seconds;

            // Convert to a string and pad with leading zeros if necessary
            let orderNumber = totalSeconds.toString().padStart(5, '0');

            return orderNumber;
        }

        function getChosenRiderName() {
            const selectedRadio = document.querySelector('input[name="rider"]:checked');

            if (selectedRadio) {
                const value = selectedRadio.value;
                const name = value.split("|")[0];
                return name;
            } else {
                return ""; // Or an empty string, depending on your preference
            }
        }

        function validateForm() {

            // Flag to track if validation has failed
            let validationFailed = false;

            // Variable to store total character count across all textareas
            let totalCharCount = 0;

            // Get all static and dynamically generated textareas
            let allTextareas = document.querySelectorAll('textarea');

            // Loop through each textarea and add its character length to totalCharCount
            allTextareas.forEach(function (textarea) {
                totalCharCount += textarea.value.length;
            });

            // Validate Rider selection
            if (!$('input[name="rider"]:checked').length) {
                $('#lblRider_0')[0].scrollIntoView({ behavior: "smooth", block: "center" });
                swalShowError('‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå');
                return false;
            }

            // Check and validate #detailArea based on conditions
            const restaurantCount = $('#restaurantList option:selected').length;
            const textAreaCount = $('#textareas')[0].childElementCount;

            let isDetailAreaRequired = true;
            if ((restaurantCount > 0 || textAreaCount > 0) && (restaurantCount === textAreaCount)) {
                isDetailAreaRequired = false;
            }

            if (isDetailAreaRequired && $('#detailArea').val().trim() === "") {
                $('#detailArea')[0].scrollIntoView({ behavior: "smooth", block: "center" });
                swalShowError('‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô');
                return false;
            }

            // Validate Address Area
            if ($('#address').val().trim() === "") {
                $('#address')[0].scrollIntoView({ behavior: "smooth", block: "center" });
                swalShowError('‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á');
                return false;
            }

            // Check if total characters exceed 900
            if (totalCharCount > 900) {
                swalShowError('‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 900 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ' + '(' + totalCharCount + ')');
                return false;  // Prevent form submission
            }

            if ($('#restaurantList option:selected').length !== $('#textareas')[0].childElementCount) {
                $('#add-to-textbox')[0].scrollIntoView({ behavior: "smooth", block: "center" });
                swalShowError('‡∏•‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡πâ‡∏≤‡∏ô');
                return false;
            }

            if (($('#restaurantList option:selected').length > 0) || ($('#textareas')[0].childElementCount > 0)) {
                if ($('input[name="notify"]:checked').val() === undefined) {
                    $('#lblNotify_0')[0].scrollIntoView({ behavior: "smooth", block: "center" });
                    swalShowError('‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô');
                    return false;
                }
            }

            if ($('input[name="notify"]:checked').val() !== undefined) {
                if (($('#restaurantList option:selected').length === 0) || ($('#textareas')[0].childElementCount === 0)) {
                    $('#add-to-textbox')[0].scrollIntoView({ behavior: "smooth", block: "center" });
                    swalShowError('‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô');
                    return false;
                }
            }

            $('#textareas textarea[id^="restaurantArea"]').each(function () {
                let value = $(this).val();
                let regex = /(?<=\d{5}\s)[\s\S]*/gm;
                let match = value.match(regex);

                // Find the associated label text
                let label = $('label[for="' + $(this).attr('id') + '"]').text();

                if (!match || match[0].trim().length === 0) {
                    $(this)[0].scrollIntoView({ behavior: "smooth", block: "center" });
                    swalShowError('‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô' + label);
                    validationFailed = true;
                }
                // If matched and not empty, do nothing
            });


            // If validation failed, prevent form submission
            if (validationFailed) {
                return false;  // Stop form submission
            }

            //To use as image name
            document.getElementById("rider").value = getChosenRiderName();
            document.getElementById("row").value = createOrderNumber();
            return true;  // Allow form submission if validation passes
        }

        document.getElementById('fileInput').addEventListener('change', mergeImagesVertically);

        document.getElementById('assignRider').addEventListener('submit', handleFormSubmit);

        async function handleFormSubmit(event) {
            event.preventDefault(); // Always prevent the default form submission
            document.getElementsByName('formSubmit')[0].disabled = true;

            if (!validateForm()) {
                document.getElementsByName('formSubmit')[0].disabled = false;
                return false;
            }

            document.getElementById('dialog-sky').style.display = 'block';
            document.getElementById('dialog-overlay').style.display = 'block';

            if (document.getElementById('fileInput').files.length > 0) {
                const success = await uploadToImgBB("Admin-");

                if (!success) {
                    document.getElementById('dialog-sky').style.display = 'none';
                    document.getElementById('dialog-overlay').style.display = 'none';
                    swal({
                        title: '‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß',
                        text: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤üòÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏á‡πÑ‡∏•‡∏ô‡πå',
                        icon: 'warning'
                    }).then(
                        function () {
                            document.getElementById('assignRider').submit();
                        }
                    )
                }
            }

            document.getElementById('assignRider').submit();
        }
    </script>
</body>

</html>